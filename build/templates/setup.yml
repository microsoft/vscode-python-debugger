# DevDiv pipeline setup steps
parameters:
  - name: installNode
    type: boolean
    default: true
  - name: installPython
    type: boolean
    default: true

steps:
  - ${{ if eq(parameters.installNode, true) }}:
      - pwsh: |
          if (-not (Test-Path '.npmrc')) {
            Write-Host 'No .npmrc found, creating one with public npm registry'
            @"
          # Force public npm registry to avoid CI auth (E401) when no token is provided
          registry=https://registry.npmjs.org/
          # Do not require auth for public installs
          always-auth=false
          "@ | Out-File -FilePath '.npmrc' -Encoding utf8
          } else {
            Write-Host '.npmrc already exists'
          }
        displayName: Ensure .npmrc exists

      - task: npmAuthenticate@0
        inputs:
          workingFile: .npmrc

      - script: npm config get registry
        displayName: Verify NPM Registry

      - task: NodeTool@0
        inputs:
          versionSpec: '22.17.0'
          checkLatest: true
        displayName: Select Node 22 LTS

  - ${{ if eq(parameters.installPython, true) }}:
      - task: PipAuthenticate@1
        displayName: 'Pip Authenticate'
        inputs:
          artifactFeeds: 'DevDiv/debugpy'

      - task: UsePythonVersion@0
        inputs:
          versionSpec: '3.9' # note Install Python dependencies step below relies on Python 3.9
          addToPath: true
          architecture: 'x64'
        displayName: Select Python version
